<div class="claim-detail-container">
  <div class="header">
    <button class="back-btn" (click)="goBack()">
      ‚Üê Back to Claims List
    </button>
    <h2>Claim Details</h2>
  </div>

  <div *ngIf="loading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Loading claim details...</p>
  </div>

  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>

  <div *ngIf="successMessage" class="success-message">
    {{ successMessage }}
  </div>

  <div *ngIf="!loading && claim" class="claim-content">
    <!-- Claim Information Card -->
    <div class="info-card">
      <h3>Claim Information</h3>
      <div class="info-grid">
        <div class="info-item">
          <label>Claim ID:</label>
          <span class="value claim-id">{{ claim.claimId }}</span>
        </div>
        <div class="info-item">
          <label>Policy Number:</label>
          <span class="value">{{ claim.policyNumber }}</span>
        </div>
        <div class="info-item">
          <label>Claimant Name:</label>
          <span class="value">{{ claim.claimantName || 'N/A' }}</span>
        </div>
        <div class="info-item">
          <label>Claim Type:</label>
          <span class="value">{{ claim.claimType || 'N/A' }}</span>
        </div>
        <div class="info-item">
          <label>Claim Amount:</label>
          <span class="value">${{ claim.claimAmount.toFixed(2) }}</span>
        </div>
        <div class="info-item">
          <label>Incident Date:</label>
          <span class="value">{{ claim.incidentDate || 'N/A' }}</span>
        </div>
        <div class="info-item">
          <label>Submission Date:</label>
          <span class="value">{{ formatDate(claim.timestamp) }}</span>
        </div>
        <div class="info-item full-width">
          <label>Current Status:</label>
          <span class="status-badge" [ngClass]="getStatusClass(claim.decisionStatus)">
            {{ claim.decisionStatus }}
          </span>
        </div>
      </div>
    </div>

    <!-- Loading Documents -->
    <div class="info-card" *ngIf="loadingDocuments">
      <h3>üìÑ Documents</h3>
      <div class="loading-text">
        Loading claim documents...
      </div>
    </div>

    <!-- Supporting Documents (All Uploaded Files) -->
    <div class="info-card" *ngIf="documents.length > 0">
      <h3>üìé Supporting Documents ({{ documents.length }})</h3>
      <p class="section-note">Documents uploaded with this claim</p>
      
      <div class="documents-grid">
        <div class="document-card" *ngFor="let doc of documents; let i = index">
          <div class="document-header">
            <span class="doc-number">#{{ i + 1 }}</span>
            <div class="document-icon">
              {{ getFileIcon(doc.contentType) }}
            </div>
          </div>
          <div class="document-info">
            <div class="document-name" [title]="doc.fileName">{{ doc.fileName }}</div>
            <div class="document-meta">
              <span class="document-size">{{ formatFileSize(doc.fileSize) }}</span>
              <span class="document-date">{{ formatDate(doc.uploadedAt) }}</span>
            </div>
            <div class="document-id">
              <small>ID: {{ doc.documentId.substring(0, 8) }}...</small>
            </div>
          </div>
          <button class="view-btn" (click)="viewDocument(doc)" title="View Document">
            üëÅÔ∏è View
          </button>
        </div>
      </div>
    </div>

    <!-- No Documents Message -->
    <div class="info-card" *ngIf="!loadingDocuments && documents.length === 0">
      <h3>üìÑ Documents</h3>
      <div class="no-documents">
        No documents were attached to this claim submission.
      </div>
    </div>

    <!-- AI Decision Card -->
    <div class="info-card">
      <h3>AI Validation Result</h3>
      <div class="decision-section">
        <div class="info-item full-width">
          <label>Explanation:</label>
          <p class="explanation-text">{{ claim.explanation }}</p>
        </div>
        <div class="info-item full-width" *ngIf="claim.reasons && claim.reasons.length > 0">
          <label>Reasons:</label>
          <ul class="reasons-list">
            <li *ngFor="let reason of claim.reasons">{{ reason }}</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Specialist Review Card -->
    <div class="info-card" *ngIf="claim.specialistId">
      <h3>Specialist Review</h3>
      <div class="info-grid">
        <div class="info-item">
          <label>Reviewed By:</label>
          <span class="value">{{ claim.specialistId }}</span>
        </div>
        <div class="info-item">
          <label>Review Date:</label>
          <span class="value">{{ formatDate(claim.reviewedAt) }}</span>
        </div>
        <div class="info-item full-width">
          <label>Specialist Notes:</label>
          <p class="notes-text">{{ claim.specialistNotes }}</p>
        </div>
      </div>
    </div>

    <!-- Specialist Action Section -->
    <div class="action-card" *ngIf="claim">
      <div class="action-header">
        <h3>Specialist Decision</h3>
        <button 
          class="action-btn" 
          (click)="toggleDecisionForm()"
          *ngIf="!showDecisionForm">
          {{ claim.specialistId ? 'Update Decision' : 'Make Decision' }}
        </button>
      </div>

      <!-- Decision Form -->
      <div class="decision-form" *ngIf="showDecisionForm">
        <div class="form-group">
          <label for="specialistId">Your ID (Specialist):</label>
          <input 
            type="text" 
            id="specialistId" 
            [(ngModel)]="decisionUpdate.specialistId"
            placeholder="Enter your specialist ID"
            class="form-input">
        </div>

        <div class="form-group">
          <label for="newStatus">Decision:</label>
          <select 
            id="newStatus" 
            [(ngModel)]="decisionUpdate.newStatus"
            class="form-select">
            <option *ngFor="let option of statusOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="specialistNotes">Specialist Notes:</label>
          <textarea 
            id="specialistNotes" 
            [(ngModel)]="decisionUpdate.specialistNotes"
            placeholder="Enter your detailed notes and reasoning for this decision..."
            rows="6"
            class="form-textarea"></textarea>
        </div>

        <div class="form-actions">
          <button 
            class="submit-btn" 
            (click)="submitDecision()"
            [disabled]="loading">
            {{ loading ? 'Submitting...' : 'Submit Decision' }}
          </button>
          <button 
            class="cancel-btn" 
            (click)="cancelDecision()"
            [disabled]="loading">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
