<div class="upload-panel">
  <div class="mode-indicator">
    @if (mode === 'claim') {
      <h3>ðŸ“‹ Upload Claim Form</h3>
      <p>Upload <strong>ONE</strong> claim form document for automatic data extraction</p>
    } @else {
      <h3>ðŸ“Ž Upload Supporting Documents</h3>
      <p><strong>âœ“ MULTI-FILE UPLOAD ENABLED:</strong> Select and upload <strong>MULTIPLE</strong> files at once</p>
      <p style="font-size: 0.9em; color: #666; margin-top: 4px;">Examples: medical records, bills, discharge summaries, diagnostic reports</p>
    }
  </div>

  <div 
    class="drop-zone"
    [class.drag-over]="isDragOver"
    (drop)="onDrop($event)"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (click)="fileInput.click()">
    
    <input 
      #fileInput 
      type="file" 
      [multiple]="mode === 'supporting'"
      accept=".pdf,.jpg,.jpeg,.png,.txt"
      (change)="onFileSelected($event)"
      style="display: none">
    
    @if (selectedFiles.length === 0) {
      <div class="drop-zone-content">
        <mat-icon>cloud_upload</mat-icon>
        @if (mode === 'claim') {
          <p>Drag & drop your claim form here</p>
          <p class="hint">or click to browse (ONE file only)</p>
        } @else {
          <p><strong>Drag & drop MULTIPLE supporting documents here</strong></p>
          <p class="hint">or click to browse and SELECT MULTIPLE FILES</p>
          <p class="hint" style="color: #2196f3; font-weight: 600;">Ctrl+Click or Shift+Click to select multiple files!</p>
        }
        <p class="formats">Supported: PDF, JPG, PNG, TXT (max 10MB each)</p>
      </div>
    } @else {
      <div class="files-list">
        @for (file of selectedFiles; track file.name; let i = $index) {
          <div class="file-preview">
            <mat-icon>description</mat-icon>
            <div class="file-info">
              <span class="file-name">{{ file.name }}</span>
              <span class="file-size">{{ formatFileSize(file.size) }}</span>
            </div>
            <button mat-icon-button (click)="removeFile($event, i)">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        }
      </div>
    }
  </div>

  @if (selectedFiles.length > 0) {
    @if (mode === 'supporting') {
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>User ID (optional)</mat-label>
        <input matInput [(ngModel)]="userId" placeholder="Enter user ID">
      </mat-form-field>
    }

    <div class="actions">
      <button mat-raised-button (click)="cancel()">Cancel</button>
      <button 
        mat-raised-button 
        color="primary" 
        (click)="uploadDocument()"
        [disabled]="isUploading">
        @if (isUploading) {
          <mat-spinner diameter="20"></mat-spinner>
          Processing...
        } @else {
          @if (mode === 'claim') {
            Extract Claim Data
          } @else {
            <strong>Upload {{ selectedFiles.length }} File{{ selectedFiles.length === 1 ? '' : 's' }}</strong>
          }
        }
      </button>
    </div>

    @if (uploadProgress > 0 && uploadProgress < 100) {
      <mat-progress-bar mode="determinate" [value]="uploadProgress"></mat-progress-bar>
    }
  }
</div>
