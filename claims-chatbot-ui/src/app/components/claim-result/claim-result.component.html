<div class="claim-result">
  <!-- Document extraction result -->
  @if (isDocumentResult && result.extractionResult) {
    <mat-card>
      <mat-card-header>
        <mat-card-title>
          <mat-icon [class.success]="result.validationStatus === 'ReadyForSubmission'" 
                    [class.warning]="result.validationStatus === 'ReadyForReview'"
                    [class.error]="result.validationStatus === 'RequiresCorrection'">
            {{ getStatusIcon() }}
          </mat-icon>
          {{ result.validationStatus }}
        </mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        <div class="confidence-section">
          <h4>Overall Confidence</h4>
          <div class="confidence-bar">
            <mat-progress-bar 
              mode="determinate" 
              [value]="result.extractionResult.overallConfidence * 100"
              [class.high]="result.extractionResult.overallConfidence >= 0.85"
              [class.medium]="result.extractionResult.overallConfidence >= 0.70 && result.extractionResult.overallConfidence < 0.85"
              [class.low]="result.extractionResult.overallConfidence < 0.70">
            </mat-progress-bar>
            <span class="confidence-value">{{ (result.extractionResult.overallConfidence * 100).toFixed(1) }}%</span>
          </div>
        </div>

        <mat-divider></mat-divider>

        <div class="extracted-data">
          <h4>Extracted Claim Details</h4>
          <div class="data-grid">
            <div class="data-item">
              <span class="label">Policy Number:</span>
              <span class="value">{{ result.extractionResult.extractedClaim.policyNumber }}</span>
              <mat-chip [class.high-confidence]="getFieldConfidence('policyNumber') >= 0.85">
                {{ (getFieldConfidence('policyNumber') * 100).toFixed(0) }}%
              </mat-chip>
            </div>

            <div class="data-item">
              <span class="label">Policy Type:</span>
              <span class="value">{{ result.extractionResult.extractedClaim.policyType }}</span>
              <mat-chip [class.high-confidence]="getFieldConfidence('policyType') >= 0.85">
                {{ (getFieldConfidence('policyType') * 100).toFixed(0) }}%
              </mat-chip>
            </div>

            <div class="data-item">
              <span class="label">Claim Amount:</span>
              <span class="value">${{ result.extractionResult.extractedClaim.claimAmount.toLocaleString() }}</span>
              <mat-chip [class.high-confidence]="getFieldConfidence('claimAmount') >= 0.85">
                {{ (getFieldConfidence('claimAmount') * 100).toFixed(0) }}%
              </mat-chip>
            </div>

            <div class="data-item full-width">
              <span class="label">Description:</span>
              <span class="value">{{ result.extractionResult.extractedClaim.claimDescription }}</span>
              <mat-chip [class.high-confidence]="getFieldConfidence('claimDescription') >= 0.85">
                {{ (getFieldConfidence('claimDescription') * 100).toFixed(0) }}%
              </mat-chip>
            </div>
          </div>
        </div>

        @if (result.extractionResult.ambiguousFields?.length > 0) {
          <mat-divider></mat-divider>
          <div class="ambiguous-fields">
            <h4>
              <mat-icon>warning</mat-icon>
              Fields Requiring Attention
            </h4>
            <mat-chip-set>
              @for (field of result.extractionResult.ambiguousFields; track field) {
                <mat-chip class="warning-chip">{{ field }}</mat-chip>
              }
            </mat-chip-set>
          </div>
        }

        <mat-divider></mat-divider>

        <div class="next-action">
          <h4>Next Action</h4>
          <p>{{ result.nextAction }}</p>
          
          <div class="action-buttons">
            @if (canSubmit) {
              <button mat-raised-button color="primary" (click)="onConfirmAndSubmit()">
                <mat-icon>check_circle</mat-icon>
                Confirm & Submit for Validation
              </button>
            }
            <button mat-stroked-button color="accent" (click)="onEditClaim()">
              <mat-icon>edit</mat-icon>
              Review & Edit Details
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  }

  <!-- Claim validation result -->
  @if (isClaimDecision) {
    <mat-card>
      <mat-card-header>
        <mat-card-title>
          <mat-icon [class.success]="result.status === 'Covered'" 
                    [class.warning]="result.status === 'Manual Review'"
                    [class.error]="result.status === 'Not Covered'">
            {{ getStatusIcon() }}
          </mat-icon>
          Claim {{ result.status }}
        </mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        <div class="confidence-section">
          <h4>Confidence Score</h4>
          <div class="confidence-bar">
            <mat-progress-bar 
              mode="determinate" 
              [value]="result.confidenceScore * 100"
              [class.high]="result.confidenceScore >= 0.85"
              [class.medium]="result.confidenceScore >= 0.70 && result.confidenceScore < 0.85"
              [class.low]="result.confidenceScore < 0.70">
            </mat-progress-bar>
            <span class="confidence-value">{{ (result.confidenceScore * 100).toFixed(1) }}%</span>
          </div>
        </div>

        @if (result.explanation) {
          <mat-divider></mat-divider>
          <div class="explanation">
            <h4>Explanation</h4>
            <p>{{ result.explanation }}</p>
          </div>
        }

        @if (result.status === 'Manual Review') {
          <mat-divider></mat-divider>
          <div class="human-review">
            <mat-icon>person</mat-icon>
            <span>This claim requires human review</span>
          </div>
        }

        @if (result.clauseReferences && result.clauseReferences.length > 0) {
          <mat-divider></mat-divider>
          <div class="clause-references">
            <h4>Relevant Policy Clauses</h4>
            <mat-chip-set>
              @for (clause of result.clauseReferences; track clause) {
                <mat-chip>{{ clause }}</mat-chip>
              }
            </mat-chip-set>
          </div>
        }

        @if (result.requiredDocuments && result.requiredDocuments.length > 0) {
          <mat-divider></mat-divider>
          <div class="required-documents">
            <h4>Required Documents</h4>
            <mat-chip-set>
              @for (doc of result.requiredDocuments; track doc) {
                <mat-chip>{{ doc }}</mat-chip>
              }
            </mat-chip-set>
          </div>
        }
      </mat-card-content>
    </mat-card>
  }
</div>
